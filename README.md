# _Manacus_ hybrid zone movement manuscript

> Long _et al._ (2024) **Ongoing introgression of a secondary sexual plumage trait in a stable avian hybrid zone**. _bioRxiv_ <https://www.biorxiv.org/content/10.1101/2023.03.30.535000v2>

Repository describing the bioinformatic code used for the analysis of population structure and movement of the _Manacus_ hybrid zone in western Panama.

## Stacks pipeline

Analysis of RADseq data using the *Stacks* [(Rochette et al. 2019)](https://catchenlab.life.illinois.edu/stacks/) software.

Main Pipeline Steps:
1. `process_radtags.sh`: Process the raw RADseq reads to clean data, demultiplex, and remove adapters.
2. `bwa_alignment.sh`: Aligns reads to a reference genome with `bwa` and indexes with `samtools`.
3. `run_gstacks.sh`: Assemble and genotype aligned reads and remove pcr duplicates with *Stacks* `gstacks`.
4. `run_populations.sh`: Filter genotypes, calculate genome-wide statistics, export various file formats with *Stacks* `populations`

Other:
* `sumstats_to_whitelist.py`: Filter a SUMSTATS file from *Stacks* `populations` to generate a whitelist containing the catalog ID of a target set of SNPs.

For a more tutorialized version of this RADseq pipeline see the following repository: <https://github.com/kiralong/RADseq_pipeline>

## Population structure analysis

Population structure analysis using PCA and Admixture

PCA:
1. `adegenet_PCA.R`: Run a principal component analysis (PCA) with the R package `adegenet` and graph the output and correlation with genomic hbyrid index with `ggplot2`.

Admixture:
1. `format_plink.sh`: After exporting PLINK files with *Stacks* `populaions --plink`, this script converts the `.ped` and `.map` files to `.bed` format.
2. `run_admixture.sh`: Submits a cluster job to run an admixture analysis with the specificed number of k populations desired.
3. `admixture_plot.R`: Plot Admixture results with stacked bar plots

For a more tutorialized version of the Admixture analysis, see the following repository: <https://github.com/kiralong/Admixture_pipeline>

## Hybrid simulations

1. `make_diagnostic_snp_whitlist.py`: Generate a whitelist of a set of parental diagnostic SNPs filtered from a user-defined set of parameters. Takes a SUMSTATS and FSTATS output from *Stacks* `populations`.
2. `sim_hybrids_from_parents_vcf.py`: Take a VCF containing genotypes from two parental populations and simulate the genotypes across several hybrid crosses.

The original source for these RADseq-based hybrid simulations can be found in the following repository: <https://github.com/arcolon14/rad_hybrid_sims>.

## GGhybrid analysis

*Stacks* `populations --structure` -> format structure file -> calculate hybrid index with `gghybrid`

1. `format_structurefile_for_gghybrid.sh`: Takes the structure file output from *Stacks* `populations --structure` and formats it for `gghybrid`
2. `gghybrid_HI.R`: Runs the `gghybrid` genomic hybrid index analysis and exports a hybrid index table and table of loci used in the calculation.

For a more tutorialized version of a `gghybrid` analysis, see the following repository: <https://github.com/kiralong/gghybrid_pipeline>

## Hybrid classification

1. `format_vcf_to_introgress.py`: Format a VCF file generated by *Stacks* `populations` into the loci and genotypes tables used as input for  `introgress` [Gompert & Buerkle 2010](https://doi.org/10.1111/j.1755-0998.2009.02733.x).
2. `calc_intersp_het.R`: Calculate interspecies heterozygosity using the `introgress` R package.

## Geographic cline analysis (genetic data)

*Stacks* `populations --hzar` -> hzar formatted file -> hzar parallelized script for SNP data -> hzar formatting/merging output -> stats and filtering

1. `hzar_parallelized.R`: R script to run a geographic cline analysis with `HZAR` on genetic (SNP) data.
2. `run_hzar.sh`: Bash script to run an array job of `hzar_parallelized.R` on a computing cluster.
3. `snp_ids_from_sumstats.sh`: Bash script to get auxillary input files for `HZAR` including a list of SNP IDs from the *Stacks* sumstats file and a lits of scaffolds/chromosome IDs. Can set how many SNPs per chromosome you want to include in list.
4. `merge_hzar_outputs.py`: Python script to merge the separated outputs from running `HZAR` as an array job into a single file. Also matches SNP IDs to make sure SNP/cline is present in both temporal datasets.
5. `parental_allele_frequency_diff.py`: Python script to calculate allele frequency differences between parental species in two populations and add to `HZAR` output file.
6. `stats_cline_centers.R`: R script to filter `HZAR` output by parental allele frequency differences and/or credibility interval and calculate summary stats of the data.

## Geographic cline analysis (phenotype data)

1. `hzar_morphological.R`: R script to run a geographic cline analysis with `HZAR` on morphological data inputs. Runs 1 traits at a time.
2. `hzar_loop_hybrid_index.R`: R script to run a geographic cline with `HZAR` on the genomic hybrid index values generated from `gghybrid`.
3. `convert_HI_table_to_hzar_format.R`: R script that converts the HI_table.txt from `gghybrid` and converts it to a `HZAR` input file.

## Data availability

Raw RAD-seq reads can be found on NCBI under BioProject [PRJNA893627](https://www.ncbi.nlm.nih.gov/bioproject/PRJNA893627).

## Notes

### 2024-04-11

KML finsihed moving all scripts from their various repositories to this manuscript-specific repo.

### 2024-04-04

ARC created a local copy of the hybrid simulation scripts from <https://github.com/arcolon14/rad_hybrid_sims>.

### 2024-03-22

Started migration of the code from other repositories, e.g., <https://github.com/kiralong/RADseq_pipeline>, into a single, manuscript-specific repo.

## Authors

Kira M. Long  
Angel G. Rivera-Colon

